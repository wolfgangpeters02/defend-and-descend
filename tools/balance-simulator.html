<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System: Reboot - Balance Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-input: #1a1a24;
            --accent-cyan: #00d4ff;
            --accent-purple: #a855f7;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --accent-orange: #f97316;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --border: #27272a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'SF Mono', 'Fira Code', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--accent-cyan);
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 12px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            font-size: 13px;
        }

        .tab:hover { border-color: var(--accent-cyan); }
        .tab.active {
            background: var(--accent-cyan);
            color: var(--bg-dark);
            border-color: var(--accent-cyan);
        }

        .panel { display: none; }
        .panel.active { display: block; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .card h3 {
            color: var(--accent-cyan);
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cause-effect {
            background: linear-gradient(90deg, var(--bg-input) 0%, rgba(0,212,255,0.1) 100%);
            border-left: 3px solid var(--accent-cyan);
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .cause-effect .cause {
            color: var(--accent-yellow);
            font-size: 13px;
            margin-bottom: 4px;
        }

        .cause-effect .effect {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .cause-effect .effect strong {
            color: var(--accent-green);
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 11px;
            margin-bottom: 4px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .input-row {
            display: flex;
            gap: 10px;
        }

        .input-row .input-group { flex: 1; }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }

        button {
            padding: 10px 20px;
            background: var(--accent-cyan);
            border: none;
            border-radius: 6px;
            color: var(--bg-dark);
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover { opacity: 0.8; }
        button.secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 12px;
        }

        .result-table th {
            text-align: left;
            padding: 10px 8px;
            background: var(--bg-input);
            color: var(--accent-cyan);
            border-bottom: 1px solid var(--border);
        }

        .result-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }

        .result-table tr:hover {
            background: rgba(0,212,255,0.05);
        }

        .result-table .highlight {
            color: var(--accent-green);
            font-weight: bold;
        }

        .result-table .warning {
            color: var(--accent-yellow);
        }

        .result-table .danger {
            color: var(--accent-red);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
        }

        .stat-row:last-child { border-bottom: none; }

        .stat-row .label { color: var(--text-secondary); }
        .stat-row .value { color: var(--accent-cyan); font-weight: bold; }

        .rarity-common { color: #71717a; }
        .rarity-rare { color: #3b82f6; }
        .rarity-epic { color: #a855f7; }
        .rarity-legendary { color: #eab308; }

        .summary-box {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .summary-box h4 {
            color: var(--accent-purple);
            font-size: 12px;
            margin-bottom: 10px;
        }

        .summary-box ul {
            list-style: none;
            font-size: 12px;
            line-height: 1.8;
        }

        .summary-box li::before {
            content: ">";
            color: var(--accent-purple);
            margin-right: 8px;
        }

        .export-area {
            width: 100%;
            height: 200px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 11px;
            padding: 12px;
            resize: vertical;
        }

        .phase-timeline {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .phase-block {
            flex: 1;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 6px;
            text-align: center;
            font-size: 11px;
        }

        .phase-block.active {
            border: 1px solid var(--accent-cyan);
        }

        .phase-block .phase-name {
            color: var(--accent-cyan);
            font-weight: bold;
            margin-bottom: 4px;
        }

        .phase-block .phase-hp {
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <h1>BALANCE SIMULATOR</h1>
    <p class="subtitle">System: Reboot // Tuning Dashboard</p>

    <div class="tabs">
        <div class="tab active" data-panel="protocols">Protocol Leveling</div>
        <div class="tab" data-panel="hash">Hash Economy</div>
        <div class="tab" data-panel="power">Power Grid</div>
        <div class="tab" data-panel="threat">Threat System</div>
        <div class="tab" data-panel="bosses">Boss Tuning</div>
        <div class="tab" data-panel="export">Export/Import</div>
    </div>

    <!-- PROTOCOL LEVELING PANEL -->
    <div id="protocols" class="panel active">
        <div class="cause-effect">
            <div class="cause">If you increase level multiplier...</div>
            <div class="effect"><strong>Higher levels deal more damage</strong>, but upgrade costs also grow exponentially. Balance determines how "worth it" late upgrades feel.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Level Scaling Config</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Damage Multiplier per Level</label>
                        <input type="number" id="proto-dmg-mult" value="1.0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Max Protocol Level</label>
                        <input type="number" id="proto-max-level" value="10" min="5" max="20">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Range per Level (%)</label>
                        <input type="number" id="proto-range-mult" value="0.05" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Fire Rate per Level (%)</label>
                        <input type="number" id="proto-fire-mult" value="0.03" step="0.01">
                    </div>
                </div>

                <h3 style="margin-top:20px">Upgrade Costs (Base Hash)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Common Base Cost</label>
                        <input type="number" id="cost-common" value="50">
                    </div>
                    <div class="input-group">
                        <label>Rare Base Cost</label>
                        <input type="number" id="cost-rare" value="100">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Epic Base Cost</label>
                        <input type="number" id="cost-epic" value="200">
                    </div>
                    <div class="input-group">
                        <label>Legendary Base Cost</label>
                        <input type="number" id="cost-legendary" value="400">
                    </div>
                </div>
                <div class="input-group">
                    <label>Cost Scaling Formula</label>
                    <select id="cost-formula">
                        <option value="exponential">Exponential: base * 2^(level-1)</option>
                        <option value="linear">Linear: base * level</option>
                        <option value="quadratic">Quadratic: base * level^2</option>
                    </select>
                </div>

                <div class="button-row">
                    <button onclick="updateProtocolChart()">Calculate</button>
                </div>
            </div>

            <div class="card">
                <h3>Damage Progression (Lv 1-10)</h3>
                <div class="cause-effect">
                    <div class="cause">Level multiplier = level number</div>
                    <div class="effect">Lv1 = 1x damage, Lv5 = 5x damage, Lv10 = <strong id="max-dmg-display">10x</strong> damage</div>
                </div>
                <div class="chart-container">
                    <canvas id="damageChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Upgrade Cost Breakdown by Rarity</h3>
            <div class="cause-effect">
                <div class="cause">Total cost Lv1 to Lv10 = sum of all upgrade costs</div>
                <div class="effect">Players need this much Hash to fully max a protocol. <strong>Higher = longer grind</strong>.</div>
            </div>
            <table class="result-table" id="upgrade-cost-table">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th class="rarity-common">Common</th>
                        <th class="rarity-rare">Rare</th>
                        <th class="rarity-epic">Epic</th>
                        <th class="rarity-legendary">Legendary</th>
                        <th>Damage</th>
                        <th>DPS Gain</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="summary-box">
                <h4>Total Cost to Max (Lv1 -> Lv10)</h4>
                <ul id="total-cost-summary"></ul>
            </div>
        </div>
    </div>

    <!-- HASH ECONOMY PANEL -->
    <div id="hash" class="panel">
        <div class="cause-effect">
            <div class="cause">If you increase Hash per second...</div>
            <div class="effect"><strong>Players accumulate currency faster</strong>, affording towers/upgrades sooner. Too fast = trivial economy. Too slow = frustrating wait.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Hash Production</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Base Hash/sec (CPU Lv1)</label>
                        <input type="number" id="hash-base" value="1.0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>CPU Level Multiplier</label>
                        <input type="number" id="hash-cpu-mult" value="1.5" step="0.1">
                    </div>
                </div>

                <h3 style="margin-top:20px">Storage Capacity</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Base Storage (DDR4)</label>
                        <input type="number" id="storage-base" value="500">
                    </div>
                    <div class="input-group">
                        <label>Storage per Upgrade</label>
                        <input type="number" id="storage-per-level" value="500">
                    </div>
                </div>
                <div class="input-group">
                    <label>Max Storage Tier</label>
                    <input type="number" id="storage-max-tier" value="8">
                </div>

                <h3 style="margin-top:20px">Multipliers</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Overclock Multiplier</label>
                        <input type="number" id="overclock-mult" value="2.0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Overclock Duration (sec)</label>
                        <input type="number" id="overclock-duration" value="60">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Online Efficiency (%)</label>
                        <input type="number" id="online-efficiency" value="100" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label>Offline Earnings (%)</label>
                        <input type="number" id="offline-rate" value="20" min="0" max="100">
                    </div>
                </div>
                <div class="input-group">
                    <label>Max Offline Hours</label>
                    <input type="number" id="offline-max-hours" value="8">
                </div>

                <div class="button-row">
                    <button onclick="updateHashChart()">Calculate</button>
                </div>
            </div>

            <div class="card">
                <h3>Hash Rate by CPU Level</h3>
                <div class="cause-effect">
                    <div class="cause">CPU Level increases Hash/sec exponentially</div>
                    <div class="effect">Rate = base * mult^(level-1). <strong>Higher CPU = faster income</strong>.</div>
                </div>
                <div class="chart-container">
                    <canvas id="hashRateChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Hash Accumulation Over Time</h3>
                <div class="cause-effect">
                    <div class="cause">Comparing CPU levels over 10 minutes</div>
                    <div class="effect">Shows how much Hash each CPU tier earns. <strong>Gap = upgrade incentive</strong>.</div>
                </div>
                <div class="chart-container">
                    <canvas id="hashAccumChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>Storage & Offline Summary</h3>
                <table class="result-table" id="storage-table">
                    <thead>
                        <tr><th>Tier</th><th>Capacity</th><th>Fill Time (Lv1 CPU)</th><th>Offline Cap (8h)</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="summary-box">
                    <h4>Offline Earnings Example</h4>
                    <ul id="offline-summary"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- POWER GRID PANEL -->
    <div id="power" class="panel">
        <div class="cause-effect">
            <div class="cause">If power demand exceeds supply...</div>
            <div class="effect"><strong>Towers shut down</strong> and Hash production stops. Players must balance tower count against CPU power budget.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Power Supply (CPU)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Base Power (Watts)</label>
                        <input type="number" id="power-base" value="100">
                    </div>
                    <div class="input-group">
                        <label>Power per CPU Level</label>
                        <input type="number" id="power-per-level" value="50">
                    </div>
                </div>
                <div class="input-group">
                    <label>Max CPU Level</label>
                    <input type="number" id="power-max-cpu" value="10">
                </div>

                <h3 style="margin-top:20px">Tower Power Draw</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Common (W)</label>
                        <input type="number" id="tower-power-common" value="15">
                    </div>
                    <div class="input-group">
                        <label>Rare (W)</label>
                        <input type="number" id="tower-power-rare" value="20">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Epic (W)</label>
                        <input type="number" id="tower-power-epic" value="30">
                    </div>
                    <div class="input-group">
                        <label>Legendary (W)</label>
                        <input type="number" id="tower-power-legendary" value="40">
                    </div>
                </div>
                <div class="input-group">
                    <label>Power per Tower Level (%)</label>
                    <input type="number" id="tower-power-scaling" value="0" step="1">
                </div>

                <h3 style="margin-top:20px">Overclock Power</h3>
                <div class="input-group">
                    <label>Overclock Power Multiplier</label>
                    <input type="number" id="overclock-power-mult" value="2.0" step="0.1">
                </div>

                <div class="button-row">
                    <button onclick="updatePowerChart()">Calculate</button>
                </div>
            </div>

            <div class="card">
                <h3>Power Budget by CPU Level</h3>
                <div class="cause-effect">
                    <div class="cause">Total Power = base + (level * perLevel)</div>
                    <div class="effect"><strong>Higher CPU = more towers allowed</strong>.</div>
                </div>
                <div class="chart-container">
                    <canvas id="powerChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Max Towers per CPU Level</h3>
            <div class="cause-effect">
                <div class="cause">Max towers = power budget / tower power draw</div>
                <div class="effect">Shows how many towers of each rarity fit in the power budget. <strong>Constraint = strategic choice</strong>.</div>
            </div>
            <table class="result-table" id="tower-limit-table">
                <thead>
                    <tr>
                        <th>CPU Level</th>
                        <th>Power Budget</th>
                        <th class="rarity-common">Max Common</th>
                        <th class="rarity-rare">Max Rare</th>
                        <th class="rarity-epic">Max Epic</th>
                        <th class="rarity-legendary">Max Legendary</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- THREAT SYSTEM PANEL -->
    <div id="threat" class="panel">
        <div class="cause-effect">
            <div class="cause">If threat growth rate increases...</div>
            <div class="effect"><strong>Enemies get stronger faster</strong>, unlocking harder enemy types sooner. Resets give players a chance to rebuild.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Threat Scaling</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Online Threat Growth (/sec)</label>
                        <input type="number" id="threat-online-rate" value="0.01" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Offline Threat Growth (/sec)</label>
                        <input type="number" id="threat-offline-rate" value="0.001" step="0.0001">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>HP Scaling per Threat</label>
                        <input type="number" id="threat-hp-scale" value="0.15" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Speed Scaling per Threat</label>
                        <input type="number" id="threat-speed-scale" value="0.02" step="0.01">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Damage Scaling per Threat</label>
                        <input type="number" id="threat-dmg-scale" value="0.05" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Max Threat Level</label>
                        <input type="number" id="threat-max" value="100">
                    </div>
                </div>

                <h3 style="margin-top:20px">Enemy Unlock Thresholds</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Fast Enemy @</label>
                        <input type="number" id="unlock-fast" value="2.0" step="0.5">
                    </div>
                    <div class="input-group">
                        <label>Swarm Enemy @</label>
                        <input type="number" id="unlock-swarm" value="4.0" step="0.5">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Tank Enemy @</label>
                        <input type="number" id="unlock-tank" value="5.0" step="0.5">
                    </div>
                    <div class="input-group">
                        <label>Elite Enemy @</label>
                        <input type="number" id="unlock-elite" value="8.0" step="0.5">
                    </div>
                </div>
                <div class="input-group">
                    <label>Mini-Boss Enemy @</label>
                    <input type="number" id="unlock-boss" value="10.0" step="0.5">
                </div>

                <h3 style="margin-top:20px">Threat Reset</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Reset Trigger (Efficiency %)</label>
                        <input type="number" id="threat-reset-trigger" value="0">
                    </div>
                    <div class="input-group">
                        <label>Reset To Level</label>
                        <input type="number" id="threat-reset-to" value="1.0" step="0.5">
                    </div>
                </div>

                <div class="button-row">
                    <button onclick="updateThreatChart()">Calculate</button>
                </div>
            </div>

            <div class="card">
                <h3>Stat Multipliers by Threat</h3>
                <div class="cause-effect">
                    <div class="cause">Higher threat = stronger enemies</div>
                    <div class="effect">HP grows fastest, then damage, then speed. <strong>Spongier before deadlier</strong>.</div>
                </div>
                <div class="chart-container">
                    <canvas id="threatChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Threat Timeline (Online Play)</h3>
            <div class="cause-effect">
                <div class="cause">Time to reach each enemy unlock threshold</div>
                <div class="effect">Shows when new enemy types appear. <strong>Pacing = player pressure curve</strong>.</div>
            </div>
            <table class="result-table" id="threat-timeline-table">
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>Threat Level</th>
                        <th>Time (Online)</th>
                        <th>HP Mult</th>
                        <th>Speed Mult</th>
                        <th>Damage Mult</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- BOSS TUNING PANEL -->
    <div id="bosses" class="panel">
        <div class="cause-effect">
            <div class="cause">If boss HP/damage increases...</div>
            <div class="effect"><strong>Fights take longer and punish mistakes more</strong>. Phase thresholds create pacing; abilities create mechanics.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Cyberboss (TD Mode Boss)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Base HP</label>
                        <input type="number" id="cyber-hp" value="4000">
                    </div>
                    <div class="input-group">
                        <label>HP Scaling / Wave</label>
                        <input type="number" id="cyber-hp-scale" value="0.15" step="0.01">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Laser Damage</label>
                        <input type="number" id="cyber-laser-dmg" value="50">
                    </div>
                    <div class="input-group">
                        <label>Laser Warning (sec)</label>
                        <input type="number" id="cyber-laser-warn" value="1.5" step="0.1">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Puddle Damage/sec</label>
                        <input type="number" id="cyber-puddle-dmg" value="20">
                    </div>
                    <div class="input-group">
                        <label>Puddle Duration (sec)</label>
                        <input type="number" id="cyber-puddle-dur" value="5.0" step="0.5">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Spawn Wave Size</label>
                        <input type="number" id="cyber-spawn-count" value="5">
                    </div>
                    <div class="input-group">
                        <label>Spawn Interval (sec)</label>
                        <input type="number" id="cyber-spawn-interval" value="8">
                    </div>
                </div>

                <h3 style="margin-top:20px">Phase Thresholds (%HP)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Phase 2 @</label>
                        <input type="number" id="cyber-phase2" value="75">
                    </div>
                    <div class="input-group">
                        <label>Phase 3 @</label>
                        <input type="number" id="cyber-phase3" value="50">
                    </div>
                    <div class="input-group">
                        <label>Phase 4 @</label>
                        <input type="number" id="cyber-phase4" value="25">
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Zero-Day Virus (Survival Boss)</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Base HP</label>
                        <input type="number" id="zeroday-hp" value="9999">
                    </div>
                    <div class="input-group">
                        <label>Speed</label>
                        <input type="number" id="zeroday-speed" value="30">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Efficiency Drain/sec</label>
                        <input type="number" id="zeroday-drain" value="2.0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Min Waves Before Spawn</label>
                        <input type="number" id="zeroday-min-waves" value="3">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Defeat Hash Bonus</label>
                        <input type="number" id="zeroday-hash" value="525">
                    </div>
                    <div class="input-group">
                        <label>Defeat Efficiency Restore</label>
                        <input type="number" id="zeroday-restore" value="30">
                    </div>
                </div>

                <div class="button-row">
                    <button onclick="updateBossChart()">Calculate</button>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Cyberboss HP by Wave</h3>
                <div class="cause-effect">
                    <div class="cause">Boss HP scales with wave number</div>
                    <div class="effect">Later bosses = longer fights. <strong>TTK matters for pacing</strong>.</div>
                </div>
                <div class="chart-container">
                    <canvas id="bossHpChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>Cyberboss Phase Visualization</h3>
                <div class="cause-effect">
                    <div class="cause">Each phase adds new abilities</div>
                    <div class="effect"><strong>Phase 1:</strong> Basic attacks | <strong>Phase 2:</strong> +Lasers | <strong>Phase 3:</strong> +Puddles | <strong>Phase 4:</strong> Enrage</div>
                </div>
                <div class="phase-timeline" id="phase-timeline">
                    <div class="phase-block">
                        <div class="phase-name">Phase 1</div>
                        <div class="phase-hp">100% - 76%</div>
                    </div>
                    <div class="phase-block">
                        <div class="phase-name">Phase 2</div>
                        <div class="phase-hp">75% - 51%</div>
                    </div>
                    <div class="phase-block">
                        <div class="phase-name">Phase 3</div>
                        <div class="phase-hp">50% - 26%</div>
                    </div>
                    <div class="phase-block">
                        <div class="phase-name">Phase 4</div>
                        <div class="phase-hp">25% - 0%</div>
                    </div>
                </div>

                <table class="result-table" style="margin-top:20px">
                    <thead>
                        <tr><th>Ability</th><th>Damage</th><th>Timing</th><th>Threat Level</th></tr>
                    </thead>
                    <tbody id="boss-ability-table"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- EXPORT/IMPORT PANEL -->
    <div id="export" class="panel">
        <div class="cause-effect">
            <div class="cause">Export your tuned values</div>
            <div class="effect">Copy JSON to update BalanceConfig.swift or share with team.</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Export Configuration</h3>
                <textarea class="export-area" id="export-json" readonly></textarea>
                <div class="button-row">
                    <button onclick="generateExport()">Generate JSON</button>
                    <button class="secondary" onclick="copyToClipboard('export-json')">Copy</button>
                </div>
            </div>

            <div class="card">
                <h3>Import Configuration</h3>
                <textarea class="export-area" id="import-json" placeholder="Paste JSON here..."></textarea>
                <div class="button-row">
                    <button onclick="importConfig()">Import</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Swift Code Generation</h3>
            <textarea class="export-area" id="swift-export" readonly style="height:400px"></textarea>
            <div class="button-row">
                <button onclick="generateSwiftCode()">Generate Swift</button>
                <button class="secondary" onclick="copyToClipboard('swift-export')">Copy</button>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.panel).classList.add('active');
            });
        });

        // Charts
        let damageChart, hashRateChart, hashAccumChart, powerChart, threatChart, bossHpChart;

        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#a1a1aa' } } },
            scales: {
                x: { ticks: { color: '#a1a1aa' }, grid: { color: '#27272a' } },
                y: { ticks: { color: '#a1a1aa' }, grid: { color: '#27272a' } }
            }
        };

        window.addEventListener('load', () => {
            initCharts();
            updateProtocolChart();
            updateHashChart();
            updatePowerChart();
            updateThreatChart();
            updateBossChart();
        });

        function initCharts() {
            damageChart = new Chart(document.getElementById('damageChart'), {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'Level', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Damage Multiplier', color: '#a1a1aa' } }
                }}
            });

            hashRateChart = new Chart(document.getElementById('hashRateChart'), {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'CPU Level', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Hash/sec', color: '#a1a1aa' } }
                }}
            });

            hashAccumChart = new Chart(document.getElementById('hashAccumChart'), {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'Time (minutes)', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Total Hash', color: '#a1a1aa' } }
                }}
            });

            powerChart = new Chart(document.getElementById('powerChart'), {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'CPU Level', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Power (Watts)', color: '#a1a1aa' } }
                }}
            });

            threatChart = new Chart(document.getElementById('threatChart'), {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'Threat Level', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Multiplier', color: '#a1a1aa' } }
                }}
            });

            bossHpChart = new Chart(document.getElementById('bossHpChart'), {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: { ...chartDefaults, scales: { ...chartDefaults.scales,
                    x: { ...chartDefaults.scales.x, title: { display: true, text: 'Wave Number', color: '#a1a1aa' } },
                    y: { ...chartDefaults.scales.y, title: { display: true, text: 'Boss HP', color: '#a1a1aa' } }
                }}
            });
        }

        // ===== PROTOCOL LEVELING =====
        function updateProtocolChart() {
            const maxLevel = parseInt(document.getElementById('proto-max-level').value);
            const dmgMult = parseFloat(document.getElementById('proto-dmg-mult').value);
            const costCommon = parseInt(document.getElementById('cost-common').value);
            const costRare = parseInt(document.getElementById('cost-rare').value);
            const costEpic = parseInt(document.getElementById('cost-epic').value);
            const costLegendary = parseInt(document.getElementById('cost-legendary').value);
            const formula = document.getElementById('cost-formula').value;

            const levels = [];
            const damages = [];

            for (let l = 1; l <= maxLevel; l++) {
                levels.push(l);
                damages.push(l * dmgMult); // Level multiplier = level number
            }

            document.getElementById('max-dmg-display').textContent = (maxLevel * dmgMult).toFixed(1) + 'x';

            damageChart.data.labels = levels;
            damageChart.data.datasets = [{
                label: 'Damage Multiplier',
                data: damages,
                backgroundColor: '#00d4ff',
                borderColor: '#00d4ff'
            }];
            damageChart.update();

            // Cost table
            const tbody = document.querySelector('#upgrade-cost-table tbody');
            tbody.innerHTML = '';

            const costs = { common: costCommon, rare: costRare, epic: costEpic, legendary: costLegendary };
            const totals = { common: 0, rare: 0, epic: 0, legendary: 0 };

            for (let l = 1; l <= maxLevel; l++) {
                const row = document.createElement('tr');
                const dmg = l * dmgMult;
                const prevDmg = l > 1 ? (l - 1) * dmgMult : 0;
                const dpsGain = l > 1 ? ((dmg - prevDmg) / prevDmg * 100).toFixed(0) : '-';

                let commonCost = 0, rareCost = 0, epicCost = 0, legendaryCost = 0;

                if (l > 1) {
                    switch (formula) {
                        case 'exponential':
                            commonCost = costCommon * Math.pow(2, l - 2);
                            rareCost = costRare * Math.pow(2, l - 2);
                            epicCost = costEpic * Math.pow(2, l - 2);
                            legendaryCost = costLegendary * Math.pow(2, l - 2);
                            break;
                        case 'linear':
                            commonCost = costCommon * (l - 1);
                            rareCost = costRare * (l - 1);
                            epicCost = costEpic * (l - 1);
                            legendaryCost = costLegendary * (l - 1);
                            break;
                        case 'quadratic':
                            commonCost = costCommon * Math.pow(l - 1, 2);
                            rareCost = costRare * Math.pow(l - 1, 2);
                            epicCost = costEpic * Math.pow(l - 1, 2);
                            legendaryCost = costLegendary * Math.pow(l - 1, 2);
                            break;
                    }

                    totals.common += commonCost;
                    totals.rare += rareCost;
                    totals.epic += epicCost;
                    totals.legendary += legendaryCost;
                }

                row.innerHTML = `
                    <td>${l}</td>
                    <td class="rarity-common">${l === 1 ? '-' : Math.floor(commonCost).toLocaleString()}</td>
                    <td class="rarity-rare">${l === 1 ? '-' : Math.floor(rareCost).toLocaleString()}</td>
                    <td class="rarity-epic">${l === 1 ? '-' : Math.floor(epicCost).toLocaleString()}</td>
                    <td class="rarity-legendary">${l === 1 ? '-' : Math.floor(legendaryCost).toLocaleString()}</td>
                    <td class="highlight">${dmg.toFixed(1)}x</td>
                    <td>${dpsGain}%</td>
                `;
                tbody.appendChild(row);
            }

            document.getElementById('total-cost-summary').innerHTML = `
                <li><span class="rarity-common">Common:</span> ${Math.floor(totals.common).toLocaleString()} Hash</li>
                <li><span class="rarity-rare">Rare:</span> ${Math.floor(totals.rare).toLocaleString()} Hash</li>
                <li><span class="rarity-epic">Epic:</span> ${Math.floor(totals.epic).toLocaleString()} Hash</li>
                <li><span class="rarity-legendary">Legendary:</span> ${Math.floor(totals.legendary).toLocaleString()} Hash</li>
            `;
        }

        // ===== HASH ECONOMY =====
        function updateHashChart() {
            const base = parseFloat(document.getElementById('hash-base').value);
            const cpuMult = parseFloat(document.getElementById('hash-cpu-mult').value);
            const storageBase = parseInt(document.getElementById('storage-base').value);
            const storagePerLevel = parseInt(document.getElementById('storage-per-level').value);
            const maxTier = parseInt(document.getElementById('storage-max-tier').value);
            const offlineRate = parseFloat(document.getElementById('offline-rate').value) / 100;
            const maxOfflineHours = parseFloat(document.getElementById('offline-max-hours').value);

            // Hash rate by CPU level
            const levels = [];
            const rates = [];
            for (let l = 1; l <= 10; l++) {
                levels.push(l);
                rates.push(base * Math.pow(cpuMult, l - 1));
            }

            hashRateChart.data.labels = levels;
            hashRateChart.data.datasets = [{
                label: 'Hash/sec',
                data: rates,
                backgroundColor: '#00d4ff'
            }];
            hashRateChart.update();

            // Hash accumulation over time (comparing CPU levels 1, 3, 5, 7)
            const times = [];
            const data1 = [], data3 = [], data5 = [], data7 = [];
            const rate1 = base * Math.pow(cpuMult, 0);
            const rate3 = base * Math.pow(cpuMult, 2);
            const rate5 = base * Math.pow(cpuMult, 4);
            const rate7 = base * Math.pow(cpuMult, 6);

            for (let m = 0; m <= 10; m++) {
                times.push(m);
                data1.push(rate1 * m * 60);
                data3.push(rate3 * m * 60);
                data5.push(rate5 * m * 60);
                data7.push(rate7 * m * 60);
            }

            hashAccumChart.data.labels = times;
            hashAccumChart.data.datasets = [
                { label: 'CPU Lv1', data: data1, borderColor: '#71717a', fill: false },
                { label: 'CPU Lv3', data: data3, borderColor: '#3b82f6', fill: false },
                { label: 'CPU Lv5', data: data5, borderColor: '#a855f7', fill: false },
                { label: 'CPU Lv7', data: data7, borderColor: '#eab308', fill: false }
            ];
            hashAccumChart.update();

            // Storage table
            const tbody = document.querySelector('#storage-table tbody');
            tbody.innerHTML = '';

            for (let t = 1; t <= maxTier; t++) {
                const capacity = storageBase + (t - 1) * storagePerLevel;
                const fillTime = capacity / rate1;
                const offlineCap = Math.min(capacity, rate1 * offlineRate * maxOfflineHours * 3600);

                tbody.innerHTML += `
                    <tr>
                        <td>Tier ${t}</td>
                        <td class="highlight">${capacity.toLocaleString()}</td>
                        <td>${formatTime(fillTime)}</td>
                        <td>${Math.floor(offlineCap).toLocaleString()}</td>
                    </tr>
                `;
            }

            // Offline summary
            document.getElementById('offline-summary').innerHTML = `
                <li>8h offline @ CPU Lv1: ${Math.floor(rate1 * offlineRate * 8 * 3600).toLocaleString()} Hash (${(offlineRate * 100).toFixed(0)}% rate)</li>
                <li>8h offline @ CPU Lv5: ${Math.floor(rate5 * offlineRate * 8 * 3600).toLocaleString()} Hash</li>
                <li>Overclock bonus: ${(parseFloat(document.getElementById('overclock-mult').value) * 100).toFixed(0)}% for ${document.getElementById('overclock-duration').value}s</li>
            `;
        }

        // ===== POWER GRID =====
        function updatePowerChart() {
            const basePower = parseInt(document.getElementById('power-base').value);
            const powerPerLevel = parseInt(document.getElementById('power-per-level').value);
            const maxCPU = parseInt(document.getElementById('power-max-cpu').value);
            const towerCommon = parseInt(document.getElementById('tower-power-common').value);
            const towerRare = parseInt(document.getElementById('tower-power-rare').value);
            const towerEpic = parseInt(document.getElementById('tower-power-epic').value);
            const towerLegendary = parseInt(document.getElementById('tower-power-legendary').value);

            const levels = [];
            const powerBudgets = [];

            for (let l = 1; l <= maxCPU; l++) {
                levels.push(l);
                powerBudgets.push(basePower + l * powerPerLevel);
            }

            powerChart.data.labels = levels;
            powerChart.data.datasets = [{
                label: 'Power Budget (W)',
                data: powerBudgets,
                backgroundColor: '#22c55e'
            }];
            powerChart.update();

            // Tower limit table
            const tbody = document.querySelector('#tower-limit-table tbody');
            tbody.innerHTML = '';

            for (let l = 1; l <= maxCPU; l++) {
                const budget = basePower + l * powerPerLevel;
                tbody.innerHTML += `
                    <tr>
                        <td>CPU ${l}</td>
                        <td class="highlight">${budget}W</td>
                        <td class="rarity-common">${Math.floor(budget / towerCommon)}</td>
                        <td class="rarity-rare">${Math.floor(budget / towerRare)}</td>
                        <td class="rarity-epic">${Math.floor(budget / towerEpic)}</td>
                        <td class="rarity-legendary">${Math.floor(budget / towerLegendary)}</td>
                    </tr>
                `;
            }
        }

        // ===== THREAT SYSTEM =====
        function updateThreatChart() {
            const onlineRate = parseFloat(document.getElementById('threat-online-rate').value);
            const hpScale = parseFloat(document.getElementById('threat-hp-scale').value);
            const speedScale = parseFloat(document.getElementById('threat-speed-scale').value);
            const dmgScale = parseFloat(document.getElementById('threat-dmg-scale').value);
            const maxThreat = parseInt(document.getElementById('threat-max').value);

            const unlockFast = parseFloat(document.getElementById('unlock-fast').value);
            const unlockSwarm = parseFloat(document.getElementById('unlock-swarm').value);
            const unlockTank = parseFloat(document.getElementById('unlock-tank').value);
            const unlockElite = parseFloat(document.getElementById('unlock-elite').value);
            const unlockBoss = parseFloat(document.getElementById('unlock-boss').value);

            const threats = [];
            const hpData = [], speedData = [], dmgData = [];

            const displayMax = Math.min(maxThreat, 30);
            for (let t = 1; t <= displayMax; t++) {
                threats.push(t);
                hpData.push(1 + (t - 1) * hpScale);
                speedData.push(1 + (t - 1) * speedScale);
                dmgData.push(1 + (t - 1) * dmgScale);
            }

            threatChart.data.labels = threats;
            threatChart.data.datasets = [
                { label: 'HP Multiplier', data: hpData, borderColor: '#ef4444', fill: false },
                { label: 'Speed Multiplier', data: speedData, borderColor: '#22c55e', fill: false },
                { label: 'Damage Multiplier', data: dmgData, borderColor: '#eab308', fill: false }
            ];
            threatChart.update();

            // Timeline table
            const tbody = document.querySelector('#threat-timeline-table tbody');
            tbody.innerHTML = '';

            const events = [
                { name: 'Fast Enemy', threat: unlockFast },
                { name: 'Swarm Enemy', threat: unlockSwarm },
                { name: 'Tank Enemy', threat: unlockTank },
                { name: 'Elite Enemy', threat: unlockElite },
                { name: 'Mini-Boss', threat: unlockBoss }
            ];

            events.forEach(e => {
                const time = e.threat / onlineRate;
                const hp = 1 + (e.threat - 1) * hpScale;
                const spd = 1 + (e.threat - 1) * speedScale;
                const dmg = 1 + (e.threat - 1) * dmgScale;

                tbody.innerHTML += `
                    <tr>
                        <td>${e.name}</td>
                        <td class="highlight">${e.threat}</td>
                        <td>${formatTime(time)}</td>
                        <td>${hp.toFixed(2)}x</td>
                        <td>${spd.toFixed(2)}x</td>
                        <td>${dmg.toFixed(2)}x</td>
                    </tr>
                `;
            });
        }

        // ===== BOSS TUNING =====
        function updateBossChart() {
            const baseHp = parseInt(document.getElementById('cyber-hp').value);
            const hpScale = parseFloat(document.getElementById('cyber-hp-scale').value);
            const laserDmg = parseInt(document.getElementById('cyber-laser-dmg').value);
            const laserWarn = parseFloat(document.getElementById('cyber-laser-warn').value);
            const puddleDmg = parseInt(document.getElementById('cyber-puddle-dmg').value);
            const puddleDur = parseFloat(document.getElementById('cyber-puddle-dur').value);
            const spawnCount = parseInt(document.getElementById('cyber-spawn-count').value);
            const spawnInterval = parseInt(document.getElementById('cyber-spawn-interval').value);

            const phase2 = parseInt(document.getElementById('cyber-phase2').value);
            const phase3 = parseInt(document.getElementById('cyber-phase3').value);
            const phase4 = parseInt(document.getElementById('cyber-phase4').value);

            // Boss HP by wave (boss appears every 5 waves)
            const waves = [];
            const hpData = [];

            for (let w = 5; w <= 30; w += 5) {
                waves.push(w);
                hpData.push(baseHp * (1 + (w - 1) * hpScale));
            }

            bossHpChart.data.labels = waves;
            bossHpChart.data.datasets = [{
                label: 'Cyberboss HP',
                data: hpData,
                borderColor: '#ef4444',
                backgroundColor: 'rgba(239,68,68,0.1)',
                fill: true
            }];
            bossHpChart.update();

            // Update phase timeline
            document.querySelector('.phase-timeline').innerHTML = `
                <div class="phase-block">
                    <div class="phase-name">Phase 1</div>
                    <div class="phase-hp">100% - ${phase2 + 1}%</div>
                </div>
                <div class="phase-block">
                    <div class="phase-name">Phase 2</div>
                    <div class="phase-hp">${phase2}% - ${phase3 + 1}%</div>
                </div>
                <div class="phase-block">
                    <div class="phase-name">Phase 3</div>
                    <div class="phase-hp">${phase3}% - ${phase4 + 1}%</div>
                </div>
                <div class="phase-block">
                    <div class="phase-name">Phase 4</div>
                    <div class="phase-hp">${phase4}% - 0%</div>
                </div>
            `;

            // Ability table
            document.getElementById('boss-ability-table').innerHTML = `
                <tr>
                    <td>Laser Beam</td>
                    <td class="danger">${laserDmg} (instant)</td>
                    <td>${laserWarn}s warning</td>
                    <td>High - avoid or die</td>
                </tr>
                <tr>
                    <td>Acid Puddle</td>
                    <td class="warning">${puddleDmg}/sec</td>
                    <td>${puddleDur}s duration</td>
                    <td>Medium - zone denial</td>
                </tr>
                <tr>
                    <td>Spawn Adds</td>
                    <td>${spawnCount} enemies</td>
                    <td>Every ${spawnInterval}s</td>
                    <td>Low - distraction</td>
                </tr>
            `;
        }

        // ===== EXPORT/IMPORT =====
        function generateExport() {
            const config = {
                protocolScaling: {
                    damageMultiplierPerLevel: parseFloat(document.getElementById('proto-dmg-mult').value),
                    rangePerLevel: parseFloat(document.getElementById('proto-range-mult').value),
                    fireRatePerLevel: parseFloat(document.getElementById('proto-fire-mult').value),
                    maxLevel: parseInt(document.getElementById('proto-max-level').value),
                    upgradeCostFormula: document.getElementById('cost-formula').value,
                    baseCosts: {
                        common: parseInt(document.getElementById('cost-common').value),
                        rare: parseInt(document.getElementById('cost-rare').value),
                        epic: parseInt(document.getElementById('cost-epic').value),
                        legendary: parseInt(document.getElementById('cost-legendary').value)
                    }
                },
                hashEconomy: {
                    baseHashPerSecond: parseFloat(document.getElementById('hash-base').value),
                    cpuLevelMultiplier: parseFloat(document.getElementById('hash-cpu-mult').value),
                    baseStorageCapacity: parseInt(document.getElementById('storage-base').value),
                    storagePerUpgrade: parseInt(document.getElementById('storage-per-level').value),
                    overclockMultiplier: parseFloat(document.getElementById('overclock-mult').value),
                    overclockDuration: parseInt(document.getElementById('overclock-duration').value),
                    offlineEarningsRate: parseFloat(document.getElementById('offline-rate').value) / 100,
                    maxOfflineHours: parseFloat(document.getElementById('offline-max-hours').value)
                },
                powerGrid: {
                    basePowerBudget: parseInt(document.getElementById('power-base').value),
                    powerPerCPULevel: parseInt(document.getElementById('power-per-level').value),
                    towerPowerDraw: {
                        common: parseInt(document.getElementById('tower-power-common').value),
                        rare: parseInt(document.getElementById('tower-power-rare').value),
                        epic: parseInt(document.getElementById('tower-power-epic').value),
                        legendary: parseInt(document.getElementById('tower-power-legendary').value)
                    },
                    overclockPowerMultiplier: parseFloat(document.getElementById('overclock-power-mult').value)
                },
                threatLevel: {
                    onlineGrowthRate: parseFloat(document.getElementById('threat-online-rate').value),
                    offlineGrowthRate: parseFloat(document.getElementById('threat-offline-rate').value),
                    healthScaling: parseFloat(document.getElementById('threat-hp-scale').value),
                    speedScaling: parseFloat(document.getElementById('threat-speed-scale').value),
                    damageScaling: parseFloat(document.getElementById('threat-dmg-scale').value),
                    maxThreatLevel: parseInt(document.getElementById('threat-max').value),
                    enemyUnlocks: {
                        fast: parseFloat(document.getElementById('unlock-fast').value),
                        swarm: parseFloat(document.getElementById('unlock-swarm').value),
                        tank: parseFloat(document.getElementById('unlock-tank').value),
                        elite: parseFloat(document.getElementById('unlock-elite').value),
                        boss: parseFloat(document.getElementById('unlock-boss').value)
                    }
                },
                cyberboss: {
                    baseHP: parseInt(document.getElementById('cyber-hp').value),
                    hpScalingPerWave: parseFloat(document.getElementById('cyber-hp-scale').value),
                    laserDamage: parseInt(document.getElementById('cyber-laser-dmg').value),
                    laserWarningDuration: parseFloat(document.getElementById('cyber-laser-warn').value),
                    puddleDamagePerSecond: parseInt(document.getElementById('cyber-puddle-dmg').value),
                    puddleDuration: parseFloat(document.getElementById('cyber-puddle-dur').value),
                    spawnWaveSize: parseInt(document.getElementById('cyber-spawn-count').value),
                    spawnInterval: parseInt(document.getElementById('cyber-spawn-interval').value),
                    phaseThresholds: {
                        phase2: parseInt(document.getElementById('cyber-phase2').value) / 100,
                        phase3: parseInt(document.getElementById('cyber-phase3').value) / 100,
                        phase4: parseInt(document.getElementById('cyber-phase4').value) / 100
                    }
                },
                zeroDay: {
                    baseHP: parseInt(document.getElementById('zeroday-hp').value),
                    speed: parseInt(document.getElementById('zeroday-speed').value),
                    efficiencyDrainRate: parseFloat(document.getElementById('zeroday-drain').value),
                    minWavesBeforeSpawn: parseInt(document.getElementById('zeroday-min-waves').value),
                    defeatHashBonus: parseInt(document.getElementById('zeroday-hash').value),
                    defeatEfficiencyRestore: parseInt(document.getElementById('zeroday-restore').value)
                }
            };

            document.getElementById('export-json').value = JSON.stringify(config, null, 2);
        }

        function importConfig() {
            try {
                const config = JSON.parse(document.getElementById('import-json').value);

                if (config.protocolScaling) {
                    document.getElementById('proto-dmg-mult').value = config.protocolScaling.damageMultiplierPerLevel ?? 1.0;
                    document.getElementById('proto-range-mult').value = config.protocolScaling.rangePerLevel ?? 0.05;
                    document.getElementById('proto-fire-mult').value = config.protocolScaling.fireRatePerLevel ?? 0.03;
                    document.getElementById('proto-max-level').value = config.protocolScaling.maxLevel ?? 10;
                    document.getElementById('cost-formula').value = config.protocolScaling.upgradeCostFormula ?? 'exponential';
                    if (config.protocolScaling.baseCosts) {
                        document.getElementById('cost-common').value = config.protocolScaling.baseCosts.common ?? 50;
                        document.getElementById('cost-rare').value = config.protocolScaling.baseCosts.rare ?? 100;
                        document.getElementById('cost-epic').value = config.protocolScaling.baseCosts.epic ?? 200;
                        document.getElementById('cost-legendary').value = config.protocolScaling.baseCosts.legendary ?? 400;
                    }
                }

                if (config.hashEconomy) {
                    document.getElementById('hash-base').value = config.hashEconomy.baseHashPerSecond ?? 1.0;
                    document.getElementById('hash-cpu-mult').value = config.hashEconomy.cpuLevelMultiplier ?? 1.5;
                    document.getElementById('storage-base').value = config.hashEconomy.baseStorageCapacity ?? 500;
                    document.getElementById('storage-per-level').value = config.hashEconomy.storagePerUpgrade ?? 500;
                    document.getElementById('overclock-mult').value = config.hashEconomy.overclockMultiplier ?? 2.0;
                    document.getElementById('overclock-duration').value = config.hashEconomy.overclockDuration ?? 60;
                    document.getElementById('offline-rate').value = (config.hashEconomy.offlineEarningsRate ?? 0.2) * 100;
                    document.getElementById('offline-max-hours').value = config.hashEconomy.maxOfflineHours ?? 8;
                }

                if (config.powerGrid) {
                    document.getElementById('power-base').value = config.powerGrid.basePowerBudget ?? 100;
                    document.getElementById('power-per-level').value = config.powerGrid.powerPerCPULevel ?? 50;
                    document.getElementById('overclock-power-mult').value = config.powerGrid.overclockPowerMultiplier ?? 2.0;
                    if (config.powerGrid.towerPowerDraw) {
                        document.getElementById('tower-power-common').value = config.powerGrid.towerPowerDraw.common ?? 15;
                        document.getElementById('tower-power-rare').value = config.powerGrid.towerPowerDraw.rare ?? 30;
                        document.getElementById('tower-power-epic').value = config.powerGrid.towerPowerDraw.epic ?? 60;
                        document.getElementById('tower-power-legendary').value = config.powerGrid.towerPowerDraw.legendary ?? 100;
                    }
                }

                if (config.threatLevel) {
                    document.getElementById('threat-online-rate').value = config.threatLevel.onlineGrowthRate ?? 0.01;
                    document.getElementById('threat-offline-rate').value = config.threatLevel.offlineGrowthRate ?? 0.001;
                    document.getElementById('threat-hp-scale').value = config.threatLevel.healthScaling ?? 0.15;
                    document.getElementById('threat-speed-scale').value = config.threatLevel.speedScaling ?? 0.02;
                    document.getElementById('threat-dmg-scale').value = config.threatLevel.damageScaling ?? 0.05;
                    document.getElementById('threat-max').value = config.threatLevel.maxThreatLevel ?? 100;
                    if (config.threatLevel.enemyUnlocks) {
                        document.getElementById('unlock-fast').value = config.threatLevel.enemyUnlocks.fast ?? 2.0;
                        document.getElementById('unlock-swarm').value = config.threatLevel.enemyUnlocks.swarm ?? 4.0;
                        document.getElementById('unlock-tank').value = config.threatLevel.enemyUnlocks.tank ?? 5.0;
                        document.getElementById('unlock-elite').value = config.threatLevel.enemyUnlocks.elite ?? 8.0;
                        document.getElementById('unlock-boss').value = config.threatLevel.enemyUnlocks.boss ?? 10.0;
                    }
                }

                if (config.cyberboss) {
                    document.getElementById('cyber-hp').value = config.cyberboss.baseHP ?? 5000;
                    document.getElementById('cyber-hp-scale').value = config.cyberboss.hpScalingPerWave ?? 0.15;
                    document.getElementById('cyber-laser-dmg').value = config.cyberboss.laserDamage ?? 50;
                    document.getElementById('cyber-laser-warn').value = config.cyberboss.laserWarningDuration ?? 1.5;
                    document.getElementById('cyber-puddle-dmg').value = config.cyberboss.puddleDamagePerSecond ?? 20;
                    document.getElementById('cyber-puddle-dur').value = config.cyberboss.puddleDuration ?? 5.0;
                    document.getElementById('cyber-spawn-count').value = config.cyberboss.spawnWaveSize ?? 5;
                    document.getElementById('cyber-spawn-interval').value = config.cyberboss.spawnInterval ?? 8;
                    if (config.cyberboss.phaseThresholds) {
                        document.getElementById('cyber-phase2').value = (config.cyberboss.phaseThresholds.phase2 ?? 0.75) * 100;
                        document.getElementById('cyber-phase3').value = (config.cyberboss.phaseThresholds.phase3 ?? 0.50) * 100;
                        document.getElementById('cyber-phase4').value = (config.cyberboss.phaseThresholds.phase4 ?? 0.25) * 100;
                    }
                }

                if (config.zeroDay) {
                    document.getElementById('zeroday-hp').value = config.zeroDay.baseHP ?? 9999;
                    document.getElementById('zeroday-speed').value = config.zeroDay.speed ?? 30;
                    document.getElementById('zeroday-drain').value = config.zeroDay.efficiencyDrainRate ?? 2.0;
                    document.getElementById('zeroday-min-waves').value = config.zeroDay.minWavesBeforeSpawn ?? 3;
                    document.getElementById('zeroday-hash').value = config.zeroDay.defeatHashBonus ?? 525;
                    document.getElementById('zeroday-restore').value = config.zeroDay.defeatEfficiencyRestore ?? 30;
                }

                // Update all charts
                updateProtocolChart();
                updateHashChart();
                updatePowerChart();
                updateThreatChart();
                updateBossChart();

                alert('Configuration imported successfully!');
            } catch (e) {
                alert('Error parsing JSON: ' + e.message);
            }
        }

        function generateSwiftCode() {
            const swift = `// Generated by Balance Simulator
// Copy relevant sections to BalanceConfig.swift

struct ProtocolScaling {
    static let damageMultiplierPerLevel: CGFloat = ${document.getElementById('proto-dmg-mult').value}
    static let rangePerLevel: CGFloat = ${document.getElementById('proto-range-mult').value}
    static let fireRatePerLevel: CGFloat = ${document.getElementById('proto-fire-mult').value}
    static let maxLevel: Int = ${document.getElementById('proto-max-level').value}
}

struct HashEconomy {
    static let baseHashPerSecond: CGFloat = ${document.getElementById('hash-base').value}
    static let cpuLevelScaling: CGFloat = ${document.getElementById('hash-cpu-mult').value}
    static let baseStorageCapacity: Int = ${document.getElementById('storage-base').value}
    static let storagePerUpgrade: Int = ${document.getElementById('storage-per-level').value}
    static let offlineEarningsRate: CGFloat = ${parseFloat(document.getElementById('offline-rate').value) / 100}
    static let maxOfflineHours: CGFloat = ${document.getElementById('offline-max-hours').value}
}

struct Overclock {
    static let duration: TimeInterval = ${document.getElementById('overclock-duration').value}
    static let hashMultiplier: CGFloat = ${document.getElementById('overclock-mult').value}
    static let powerDemandMultiplier: CGFloat = ${document.getElementById('overclock-power-mult').value}
}

struct PowerGrid {
    static let basePowerBudget: Int = ${document.getElementById('power-base').value}
    static let powerPerCPULevel: Int = ${document.getElementById('power-per-level').value}
    // Tower power is defined per-protocol in Protocol.swift
}

struct ThreatLevel {
    static let maxThreatLevel: CGFloat = ${document.getElementById('threat-max').value}
    static let onlineThreatGrowthRate: CGFloat = ${document.getElementById('threat-online-rate').value}
    static let offlineThreatGrowthRate: CGFloat = ${document.getElementById('threat-offline-rate').value}
    static let healthScaling: CGFloat = ${document.getElementById('threat-hp-scale').value}
    static let speedScaling: CGFloat = ${document.getElementById('threat-speed-scale').value}
    static let damageScaling: CGFloat = ${document.getElementById('threat-dmg-scale').value}
    static let fastEnemyThreshold: CGFloat = ${document.getElementById('unlock-fast').value}
    static let swarmEnemyThreshold: CGFloat = ${document.getElementById('unlock-swarm').value}
    static let tankEnemyThreshold: CGFloat = ${document.getElementById('unlock-tank').value}
    static let eliteEnemyThreshold: CGFloat = ${document.getElementById('unlock-elite').value}
    static let bossEnemyThreshold: CGFloat = ${document.getElementById('unlock-boss').value}
}

struct Cyberboss {
    static let baseHealth: CGFloat = ${document.getElementById('cyber-hp').value}
    static let healthScalingPerWave: CGFloat = ${document.getElementById('cyber-hp-scale').value}
    static let laserDamage: CGFloat = ${document.getElementById('cyber-laser-dmg').value}
    static let laserWarningDuration: TimeInterval = ${document.getElementById('cyber-laser-warn').value}
    static let puddleDamagePerSecond: CGFloat = ${document.getElementById('cyber-puddle-dmg').value}
    static let puddleDuration: TimeInterval = ${document.getElementById('cyber-puddle-dur').value}
    static let spawnWaveSize: Int = ${document.getElementById('cyber-spawn-count').value}
    static let spawnInterval: TimeInterval = ${document.getElementById('cyber-spawn-interval').value}
    static let phase2Threshold: CGFloat = ${parseInt(document.getElementById('cyber-phase2').value) / 100}
    static let phase3Threshold: CGFloat = ${parseInt(document.getElementById('cyber-phase3').value) / 100}
    static let phase4Threshold: CGFloat = ${parseInt(document.getElementById('cyber-phase4').value) / 100}
}

struct ZeroDay {
    static let baseHealth: CGFloat = ${document.getElementById('zeroday-hp').value}
    static let speed: CGFloat = ${document.getElementById('zeroday-speed').value}
    static let efficiencyDrainRate: CGFloat = ${document.getElementById('zeroday-drain').value}
    static let minWavesBeforeSpawn: Int = ${document.getElementById('zeroday-min-waves').value}
    static let defeatHashBonus: Int = ${document.getElementById('zeroday-hash').value}
    static let defeatEfficiencyRestore: Int = ${document.getElementById('zeroday-restore').value}
}`;

            document.getElementById('swift-export').value = swift;
        }

        function copyToClipboard(elementId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        // Utility functions
        function formatTime(seconds) {
            if (seconds < 60) return Math.floor(seconds) + 's';
            if (seconds < 3600) return (seconds / 60).toFixed(1) + 'm';
            return (seconds / 3600).toFixed(1) + 'h';
        }
    </script>
</body>
</html>
